% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/heterogeneity.R
\name{calculate_heterogeneity}
\alias{calculate_heterogeneity}
\title{Calculate Heterogeneity of LR Pairs or Pathways Across Samples}
\usage{
calculate_heterogeneity(
  data_list,
  feature_col = "interaction_name",
  value_col = "pval",
  pval_threshold = 0.05,
  method = "frequency",
  min_samples = 2,
  top_n = NULL
)
}
\arguments{
\item{data_list}{A named list of data frames, where each element represents one sample.
This is the output from loading functions like loadingLR_cellchat() or loadingPWY_cellchat().
Each data frame should have columns:
\itemize{
  \item For LR data: interaction_name, pval (and optionally prob, count)
  \item For pathway data: pathway_name, pval (and optionally prob, count)
}}

\item{feature_col}{Character string specifying the column name for features.
Default is "interaction_name" for LR pairs. Use "pathway_name" for pathways.}

\item{value_col}{Character string specifying which value to use for calculating
heterogeneity. Options: "pval" (default), "prob", or "count".}

\item{pval_threshold}{Numeric value for p-value threshold. Features with pval >
threshold are considered "absent" in that sample. Default is 0.05.}

\item{method}{Character string specifying the heterogeneity metric. Options:
\itemize{
  \item "frequency" (default): Calculate how many samples each feature appears in
  \item "cv": Coefficient of variation of values across samples
  \item "range": Range (max - min) of values
  \item "all": Calculate all metrics
}}

\item{min_samples}{Integer specifying minimum number of samples where a feature
must be present to be included. Default is 2.}

\item{top_n}{Integer specifying how many features to return, sorted by heterogeneity.
If NULL (default), returns all features.}
}
\value{
A data frame with the following columns:
  \itemize{
    \item feature: Feature name (LR pair or pathway)
    \item n_samples: Number of samples where feature is present (significant)
    \item frequency: Proportion of samples where feature is present
    \item mean_value: Mean value (pval/prob/count) across samples where present
    \item Additional columns based on method selected
  }
}
\description{
Identify LR pairs or pathways that show high variability across samples, indicating
sample-specific or heterogeneous communication patterns. This function takes the
output from loading functions (e.g., loadingLR_cellchat, loadingPWY_cellchat) and
calculates heterogeneity metrics to understand consistency across samples.
}
\details{
This function helps identify which features (LR pairs or pathways) are:
- **Consistent**: Present in most/all samples (high frequency, low heterogeneity)
- **Variable**: Present in some samples but not others (medium frequency)
- **Rare**: Present in few samples (low frequency)

Understanding heterogeneity is crucial before performing downstream analyses,
as it reveals whether you're working with consistent biological patterns or
sample-specific noise.
}
\examples{
\dontrun{
# Load LR pair data
lr_data <- loadingLR_cellchat(sample = sample_names,
                              directory = data_dir,
                              value = "pval")

# Calculate frequency-based heterogeneity
lr_het <- calculate_heterogeneity(
  lr_data,
  feature_col = "interaction_name",
  value_col = "pval",
  pval_threshold = 0.05,
  method = "frequency"
)

# View most heterogeneous features
head(lr_het)

# Calculate all metrics for pathway data
pwy_data <- loadingPWY_cellchat(sample = sample_names,
                                directory = data_dir,
                                value = "pval")

pwy_het <- calculate_heterogeneity(
  pwy_data,
  feature_col = "pathway_name",
  method = "all"
)
}

}
